<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Prototipo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: radial-gradient(ellipse at top, #1a1a2e, #16213e, #0f0f23);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Animated background particles */
        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #00d4ff; /* Lighter blue for particles */
            border-radius: 50%;
            opacity: 0.6;
            animation: float 20s infinite ease-in-out;
        }

        /* Keyframes for particle animation */
        @keyframes float {
            0% { transform: translateY(0) translateX(0); opacity: 0.6; }
            25% { transform: translateY(-20px) translateX(10px); opacity: 0.8; }
            50% { transform: translateY(0) translateX(0); opacity: 0.6; }
            75% { transform: translateY(20px) translateX(-10px); opacity: 0.4; }
            100% { transform: translateY(0) translateX(0); opacity: 0.6; }
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: #00d4ff; /* Light blue text */
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .header p {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Dashboard Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Dashboard Card Styles */
        .dashboard-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .dashboard-card h3.card-title {
            color: #00d4ff;
            font-size: 1.6em;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 10px;
        }

        /* Form Styling */
        .dashboard-card form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .dashboard-card form label {
            font-weight: bold;
            color: #c0c0c0;
        }

        .dashboard-card form input[type="text"],
        .dashboard-card form input[type="date"],
        .dashboard-card form select {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            font-size: 1em;
            outline: none;
            transition: border-color 0.3s;
        }

        .dashboard-card form input[type="text"]:focus,
        .dashboard-card form input[type="date"]:focus,
        .dashboard-card form select:focus {
            border-color: #00d4ff;
        }

        .dashboard-card form button {
            padding: 14px 20px;
            background: linear-gradient(90deg, #00d4ff 0%, #00aaff 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
        }

        .dashboard-card form button:hover {
            background: linear-gradient(90deg, #00aaff 0%, #00d4ff 100%);
            transform: translateY(-2px);
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(0, 212, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .stat-item .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00ff88; /* Green for positive values */
            margin-bottom: 5px;
        }
        .stat-item .value.negative {
            color: #ff4500; /* Orange-red for negative values */
        }

        .stat-item .label {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Tables */
        .dashboard-card table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .dashboard-card table th,
        .dashboard-card table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dashboard-card table th {
            color: #00d4ff;
            font-weight: bold;
            font-size: 0.95em;
            text-transform: uppercase;
        }

        .dashboard-card table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .dashboard-card table td {
            color: #c0c0c0;
        }

        .dashboard-card table td strong {
            color: #ffffff;
        }

        /* Charts */
        .chart-container {
            width: 100%;
            max-height: 400px; /* Limit height for charts */
            margin: 0 auto;
        }

        /* Alerts Section */
        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        .alert-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #00d4ff;
        }

        .alert-item strong {
            color: #00d4ff;
        }

        .alert-item small {
            color: rgba(255, 255, 255, 0.6);
            display: block;
            margin-top: 5px;
        }

        .alert-item div:last-child {
            font-weight: bold;
        }

        .alert-item.alert-active {
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            background: rgba(0, 255, 136, 0.1);
        }
        .alert-item.alert-active div:last-child {
            color: #00ff88;
        }

        .alert-item.alert-pending {
             border-color: #ffcc00;
             box-shadow: 0 0 15px rgba(255, 204, 0, 0.4);
             background: rgba(255, 204, 0, 0.1);
         }
        .alert-item.alert-pending div:last-child {
             color: #ffcc00;
         }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="bg-particles" id="particles"></div>

    <div class="container">
        <header class="header">
            <h1>CryptoWise Dashboard</h1>
            <p>Análise de Portfólio Otimizado e Monitoramento de Oportunidades de Arbitragem</p>
        </header>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3 class="card-title">Visão Geral Rápida</h3>
                <div class="quick-stats">
                    <div class="stat-item">
                        <div class="value" id="overview-return">--</div>
                        <div class="label">Retorno Anualizado</div>
                    </div>
                    <div class="stat-item">
                        <div class="value" id="overview-volatility">--</div>
                        <div class="label">Volatilidade</div>
                    </div>
                    <div class="stat-item">
                        <div class="value" id="overview-sharpe">--</div>
                        <div class="label">Sharpe Ratio</div>
                    </div>
                    <div class="stat-item">
                        <div class="value" id="overview-arbitrage-alerts">--</div>
                        <div class="label">Alertas Ativos</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h3 class="card-title">Configuração de Otimização</h3>
                <form id="portfolioConfigForm">
                    <label for="tickers">Selecione as Criptomoedas:</label>
                    <select id="tickers" multiple size="5" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(0, 0, 0, 0.3); color: #ffffff; font-size: 1em; outline: none; transition: border-color 0.3s; /* Estilo do seu CSS */">
                    <option value="BTC-USD" selected>Bitcoin (BTC)</option>
                    <option value="ETH-USD" selected>Ethereum (ETH)</option>
                    <option value="BNB-USD" selected>Binance Coin (BNB)</option>
                    <option value="ADA-USD" selected>Cardano (ADA)</option>
                    <option value="SOL-USD" selected>Solana (SOL)</option>
                    <option value="XRP-USD">XRP</option>
                    <option value="DOGE-USD">Dogecoin (DOGE)</option>
                    <option value="DOT-USD">Polkadot (DOT)</option>
                    <option value="LTC-USD">Litecoin (LTC)</option>
                    <option value="LINK-USD">Chainlink (LINK)</option>
                    </select>

                    <label for="start_date">Data de Início:</label>
                    <input type="date" id="start_date" value="2023-05-01" required>

                    <label for="end_date">Data de Fim:</label>
                    <input type="date" id="end_date" value="2024-05-01" required>

                    <label for="risk_free_rate">Taxa Livre de Risco Anual (ex: 0.053 para 5.3%):</label>
                    <input type="text" id="risk_free_rate" value="0.053" required>

                    <label for="objective">Objetivo de Otimização:</label>
                    <select id="objective" required>
                        <option value="sharpe">Maximizar Sharpe Ratio</option>
                        <option value="min_volatility">Minimizar Volatilidade</option>
                    </select>

                    <button type="submit">Otimizar Portfólio</button>
                </form>
            </div>
            
            <div class="dashboard-card" style="grid-column: span 2;">
                <h3 class="card-title">📊 Alocação de Peso do Portfólio</h3>
                <div class="chart-container">
                    <canvas id="allocationChart"></canvas>
                </div>
            </div>

            <div class="dashboard-card" style="grid-column: span 2;">
                <h3 class="card-title">📈 Portfólio Otimizado (Pesos, Retorno, Volatilidade, Sharpe)</h3>
                <div style="overflow-x: auto;">
                    <table id="portfolioTable">
                        <thead>
                            <tr>
                                <th>Ativo</th>
                                <th>Peso</th>
                                <th>Retorno Anual</th>
                                <th>Volatilidade</th>
                                <th>Sharpe Ratio</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="dashboard-card">
                <h3 class="card-title">📊 Métricas de Performance da Carteira</h3>
                <div style="overflow-x: auto;">
                    <table id="metricsTable">
                        <thead>
                            <tr>
                                <th>Métrica</th>
                                <th>Valor</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Retorno Anualizado</td><td id="metric-annual-return">--</td></tr>
                            <tr><td>Volatilidade Anualizada</td><td id="metric-annual-volatility">--</td></tr>
                            <tr><td>Sharpe Ratio</td><td id="metric-sharpe-ratio">--</td></tr>
                            <tr><td>Max Drawdown</td><td id="metric-max-drawdown">--</td></tr>
                            <tr><td>Calmar Ratio</td><td id="metric-calmar-ratio">--</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="dashboard-card">
                <h3 class="card-title">Fronteira Eficiente</h3>
                <div class="chart-container">
                    <canvas id="efficientFrontierChart"></canvas>
                </div>
            </div>

            <div class="dashboard-card" style="grid-column: span 2;">
                <h3 class="card-title">Performance da Carteira (Backtesting)</h3>
                <div class="chart-container">
                    <canvas id="backtestChart"></canvas>
                </div>
            </div>

            <div class="dashboard-card" style="grid-column: span 2;">
                <h3 class="card-title">Alertas de Oportunidades de Arbitragem</h3>
                <div class="alerts-list" id="arbitrageAlerts">
                    <div class="alert-item alert-active">
                        <div>
                            <strong>BTC/USDT - Binance vs. Kraken</strong><br>
                            <small>Diferença: +1.5% | Lucro Líquido Estimado: $50</small>
                        </div>
                        <div style="color: #00ff88;">Ativo</div>
                    </div>
                    <div class="alert-item alert-pending">
                        <div>
                            <strong>ETH/USDT - Coinbase vs. Bybit</strong><br>
                            <small>Diferença: +0.8% | Aguardando liquidez</small>
                        </div>
                        <div style="color: #ffcc00;">Pendente</div>
                    </div>
                    <div class="alert-item">
                        <div>
                            <strong>SOL/USDT - OKX vs. Gate.io</strong><br>
                            <small>Diferença: -0.2% | Não lucrativo</small>
                        </div>
                        <div style="color: rgba(255,255,255,0.5);">Inativo</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card" style="grid-column: span 2;">
                <h3 class="card-title">Visão Geral do Mercado / Exchanges</h3>
                <div class="chart-container">
                    <canvas id="marketOverviewChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize particles background
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50; // Adjust for performance

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animationDuration = `${Math.random() * 15 + 10}s`; // 10-25s
                particle.style.animationDelay = `${Math.random() * 5}s`;
                particlesContainer.appendChild(particle);
            }
        }

        // Chart instances
        let allocationChart, efficientFrontierChart, backtestChart, marketOverviewChart;

        // Function to create/update Allocation Chart (Pie/Doughnut)
        function createAllocationChart(assets) {
            const ctx = document.getElementById('allocationChart').getContext('2d');
            if (allocationChart) allocationChart.destroy();

            const labels = assets.map(a => a.symbol.replace('-USD', ''));
            const data = assets.map(a => (a.weight * 100).toFixed(1));
            const colors = [
                'rgba(0, 212, 255, 0.7)', 'rgba(0, 170, 255, 0.7)', 'rgba(0, 130, 255, 0.7)',
                'rgba(0, 90, 255, 0.7)', 'rgba(0, 50, 255, 0.7)', 'rgba(0, 10, 255, 0.7)',
                'rgba(50, 10, 255, 0.7)', 'rgba(90, 10, 255, 0.7)', 'rgba(130, 10, 255, 0.7)',
                'rgba(170, 10, 255, 0.7)'
            ];

            allocationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#e0e0e0'
                            }
                        },
                        datalabels: { // Using chartjs-plugin-datalabels
                            color: '#fff',
                            formatter: (value) => `${value}%`,
                            font: {
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += `${context.parsed}%`;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }

        // Function to create/update Efficient Frontier Chart
        function createEfficientFrontierChart(dataPoints, optimalPoint) {
            const ctx = document.getElementById('efficientFrontierChart').getContext('2d');
            if (efficientFrontierChart) efficientFrontierChart.destroy();

            efficientFrontierChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Fronteira Eficiente',
                        data: dataPoints, // {x: volatility, y: return}
                        backgroundColor: 'rgba(0, 212, 255, 0.6)',
                        borderColor: 'rgba(0, 212, 255, 1)',
                        borderWidth: 1,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    },
                    {
                        label: 'Portfólio Otimizado',
                        data: [optimalPoint], // {x: volatility, y: return}
                        backgroundColor: 'rgba(0, 255, 136, 1)',
                        borderColor: 'rgba(0, 255, 136, 1)',
                        borderWidth: 2,
                        pointRadius: 8,
                        pointStyle: 'star', // Make the optimal point stand out
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    if (context.parsed) {
                                        return `${label} - Retorno: ${(context.parsed.y * 100).toFixed(2)}%, Volatilidade: ${(context.parsed.x * 100).toFixed(2)}%`;
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Volatilidade Anualizada',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                callback: value => `${(value * 100).toFixed(0)}%`,
                                color: '#c0c0c0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Retorno Anualizado',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                callback: value => `${(value * 100).toFixed(0)}%`,
                                color: '#c0c0c0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Function to create/update Backtesting Performance Chart
        function createBacktestChart(dates, portfolioReturns, benchmarkReturns) {
            const ctx = document.getElementById('backtestChart').getContext('2d');
            if (backtestChart) backtestChart.destroy();

            backtestChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Portfólio Otimizado',
                        data: portfolioReturns,
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    },
                    {
                        label: 'Benchmark (e.g., Bitcoin)',
                        data: benchmarkReturns, // Placeholder for a benchmark like BTC
                        borderColor: '#ffcc00',
                        backgroundColor: 'rgba(255, 204, 0, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${(context.parsed.y * 100).toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'category',
                            title: {
                                display: true,
                                text: 'Data',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#c0c0c0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Retorno Acumulado',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                callback: value => `${(value * 100).toFixed(0)}%`,
                                color: '#c0c0c0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Function to create/update Market Overview/Exchange Performance Chart (Radar or Bar)
        function createMarketOverviewChart(labels, data) {
            const ctx = document.getElementById('marketOverviewChart').getContext('2d');
            if (marketOverviewChart) marketOverviewChart.destroy();

            marketOverviewChart = new Chart(ctx, {
                type: 'radar', // Could also be 'bar' or 'line' based on data type
                data: {
                    labels: labels, // e.g., ['Binance', 'Kraken', 'Coinbase']
                    datasets: [{
                        label: 'Sharpe Ratio Médio por Exchange', // Example usage for arbitrage context
                        data: data, // e.g., [1.2, 0.9, 1.1]
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(255, 99, 132, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            },
                            pointLabels: {
                                color: '#e0e0e0'
                            },
                            ticks: {
                                backdropColor: 'rgba(26, 26, 46, 0.8)', // Dark background for ticks
                                color: '#c0c0c0'
                            }
                        }
                    }
                }
            });
        }


        // Function to update Portfolio Table
        function createPortfolioTable(assets) {
            const tbody = document.getElementById('portfolioTable').querySelector('tbody');
            tbody.innerHTML = ''; // Clear existing rows
            assets.forEach(asset => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${asset.symbol.replace('-USD', '')}</strong></td>
                    <td>${(asset.weight * 100).toFixed(1)}%</td>
                    <td>${(asset.annualReturn * 100).toFixed(1)}%</td>
                    <td>${(asset.volatility * 100).toFixed(1)}%</td>
                    <td>${asset.sharpeRatio.toFixed(2)}</td>
                `;
            });
        }

        // Function to update Metrics Table and Quick Overview
        function updateMetrics(performanceMetrics, backtestResults) {
            document.getElementById('metric-annual-return').innerText = `${(performanceMetrics.annualReturn * 100).toFixed(2)}%`;
            document.getElementById('metric-annual-volatility').innerText = `${(performanceMetrics.volatility * 100).toFixed(2)}%`;
            document.getElementById('metric-sharpe-ratio').innerText = performanceMetrics.sharpeRatio.toFixed(2);
            document.getElementById('metric-max-drawdown').innerText = `${(backtestResults.maxDrawdown * 100).toFixed(2)}%`;
            document.getElementById('metric-calmar-ratio').innerText = backtestResults.calmarRatio.toFixed(2);

            // Update Quick Overview
            document.getElementById('overview-return').innerText = `${(performanceMetrics.annualReturn * 100).toFixed(1)}%`;
            document.getElementById('overview-volatility').innerText = `${(performanceMetrics.volatility * 100).toFixed(1)}%`;
            document.getElementById('overview-sharpe').innerText = performanceMetrics.sharpeRatio.toFixed(2);
            // Placeholder for arbitrage alerts, update with real logic
            document.getElementById('overview-arbitrage-alerts').innerText = '3 Ativos'; // Example
        }


        // Placeholder for fetching data (replace with actual API calls to Python backend)
        async function fetchPortfolioData(tickers, startDate, endDate, riskFreeRate, objective) {
            console.log("Simulando busca de dados e otimização...", { tickers, startDate, endDate, riskFreeRate, objective });

            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1500));

            // --- SIMULATED DATA ---
            const simulatedAssets = [
                { symbol: 'BTC-USD', weight: 0.4, annualReturn: 0.35, volatility: 0.6, sharpeRatio: 0.5 },
                { symbol: 'ETH-USD', weight: 0.3, annualReturn: 0.30, volatility: 0.55, sharpeRatio: 0.45 },
                { symbol: 'BNB-USD', weight: 0.15, annualReturn: 0.25, volatility: 0.5, sharpeRatio: 0.4 },
                { symbol: 'SOL-USD', weight: 0.1, annualReturn: 0.28, volatility: 0.7, sharpeRatio: 0.35 },
                { symbol: 'ADA-USD', weight: 0.05, annualReturn: 0.15, volatility: 0.45, sharpeRatio: 0.2 }
            ];

            const simulatedPerformance = {
                annualReturn: 0.28,
                volatility: 0.48,
                sharpeRatio: 0.48
            };

            const simulatedBacktestDates = Array.from({length: 12}, (_, i) => {
                const d = new Date(startDate);
                d.setMonth(d.getMonth() + i);
                return d.toISOString().split('T')[0];
            });
            const simulatedPortfolioReturns = [0.0, 0.05, 0.08, 0.15, 0.12, 0.20, 0.18, 0.25, 0.22, 0.30, 0.28, 0.35]; // Cumulative
            const simulatedBenchmarkReturns = [0.0, 0.03, 0.06, 0.10, 0.09, 0.15, 0.13, 0.20, 0.18, 0.25, 0.23, 0.30]; // Cumulative BTC

            const simulatedBacktestMetrics = {
                maxDrawdown: -0.15,
                calmarRatio: 1.8
            };

            const simulatedEfficientFrontierPoints = [
                { x: 0.3, y: 0.1 }, { x: 0.35, y: 0.15 }, { x: 0.4, y: 0.2 },
                { x: 0.45, y: 0.25 }, { x: 0.48, y: 0.28 }, { x: 0.5, y: 0.27 }
            ];
            const simulatedOptimalPoint = { x: 0.48, y: 0.28 };

            const simulatedMarketOverviewData = {
                labels: ['Binance', 'Kraken', 'Coinbase', 'Bybit'],
                data: [1.2, 0.9, 1.1, 1.3] // Example Sharpe Ratios for Exchanges
            };
            // --- END SIMULATED DATA ---

            // Call functions to update UI with simulated data
            createAllocationChart(simulatedAssets);
            createPortfolioTable(simulatedAssets);
            updateMetrics(simulatedPerformance, simulatedBacktestMetrics);
            createEfficientFrontierChart(simulatedEfficientFrontierPoints, simulatedOptimalPoint);
            createBacktestChart(simulatedBacktestDates, simulatedPortfolioReturns, simulatedBenchmarkReturns);
            createMarketOverviewChart(simulatedMarketOverviewData.labels, simulatedMarketOverviewData.data);
            
            console.log("Análise de portfólio simulada concluída.");
        }


        // Event Listener for Form Submission
        document.getElementById('portfolioConfigForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const tickers = document.getElementById('tickers').value;
            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const riskFreeRate = parseFloat(document.getElementById('risk_free_rate').value);
            const objective = document.getElementById('objective').value;

            // In a real application, you would send this data to your Python backend
            // For now, we'll use simulated data
            fetchPortfolioData(tickers, startDate, endDate, riskFreeRate, objective);
        });


        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            // Set default dates
            const today = new Date();
            const oneYearAgo = new Date(today);
            oneYearAgo.setFullYear(today.getFullYear() - 1);
            document.getElementById('end_date').value = today.toISOString().split('T')[0];
            document.getElementById('start_date').value = oneYearAgo.toISOString().split('T')[0];
            
            // Optionally run a default analysis on load
            document.getElementById('portfolioConfigForm').dispatchEvent(new Event('submit'));
        });
    </script>
</body>
</html>